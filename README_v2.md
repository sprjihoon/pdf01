# PDF Excel Matcher v2.0 - 구매자 순서로 PDF 자동 정렬

엑셀 파일의 구매자 정보(이름+전화번호+주소)를 기준으로 PDF 페이지를 자동으로 재정렬하는 데스크탑 GUI 애플리케이션입니다.

## 📌 주요 기능

- **3요소 매칭**: 구매자명 + 전화번호 + 주소 (3가지 모두 일치해야 매칭)
- **스마트 정규화**: 전화번호, 이름, 주소의 표기 차이를 자동 처리
- **버전 관리**: `ordered_YYYYMMDD.pdf` 자동 생성, 중복 시 `_v2`, `_v3` 자동 증가
- **CSV 리포트**: 페이지별 매칭 결과를 상세하게 기록
- **유사도 매칭**: 선택적으로 오타나 표기 차이 보정 (임계값 조정 가능)
- **직관적 GUI**: PySide6 기반의 사용하기 쉬운 인터페이스
- **단일 EXE 파일**: 설치 없이 바로 실행 가능

## 🛠️ 설치 방법

### 1. Python 환경 설정 (Python 3.11 권장)

```bash
# 가상환경 생성
python -m venv .venv

# 가상환경 활성화 (Windows)
.venv\Scripts\activate

# 가상환경 활성화 (Mac/Linux)
source .venv/bin/activate
```

### 2. 필요한 패키지 설치

```bash
pip install --upgrade pip
pip install -r requirements.txt
```

## 🚀 실행 방법

### 개발 모드로 실행

```bash
python main.py
```

### EXE 파일로 빌드

```bash
# Windows
build.bat

# 빌드 완료 후
dist\PDFReorderApp.exe
```

## 📖 사용 방법

### 1단계: 파일 준비

**엑셀 파일 (.xlsx, .xls):**
- 필수 컬럼: `구매자명`, `전화번호`, `주소`
- 컬럼명은 유사한 이름도 자동 인식 (예: "이름", "name", "buyer" 등)

예시:
| 구매자명 | 전화번호 | 주소 |
|----------|----------|------|
| 홍길동 | 010-1234-5678 | 서울시 강남구 테헤란로 123, 101동 402호 |
| 김철수 | 010-9876-5432 | 부산시 해운대구 센텀로 456 (센텀시티) |

**PDF 파일:**
- 텍스트 기반 PDF (이미지 스캔 PDF는 지원하지 않음)
- 각 페이지에 구매자명, 전화번호, 주소가 포함되어야 함

### 2단계: 프로그램 실행

1. **파일 선택**
   - 엑셀 파일 선택
   - PDF 파일 선택
   - 출력 폴더 선택 (결과 파일이 저장될 위치)

2. **매칭 옵션 설정**
   - **기본 (권장)**: 정확 일치만 인정
   - **유사도 매칭**: 오타나 표기 차이가 있을 때 사용
     - 체크박스 활성화
     - 임계값 조정 (기본 90%, 50-100%)

3. **실행**
   - [PDF 정렬 실행] 버튼 클릭
   - 진행 상황을 로그 창에서 확인

### 3단계: 결과 확인

**출력 파일:**
- `ordered_YYYYMMDD.pdf`: 정렬된 PDF
- `ordered_YYYYMMDD_match_report.csv`: 매칭 리포트

**파일명 버전 관리:**
- 같은 날 여러 번 실행 시 자동으로 버전 증가
- `ordered_20250109.pdf` → `ordered_20250109_v2.pdf` → `ordered_20250109_v3.pdf`

## 📋 매칭 로직 상세

### 정규화 규칙

**전화번호:**
- 숫자만 추출: `010-1234-5678` → `01012345678`
- 010으로 시작하는 10-11자리 번호만 인정

**구매자명:**
- 공백, 특수문자 제거: `홍 길동` → `홍길동`
- 영문은 대문자화: `John Doe` → `JOHNDOE`

**주소:**
- 괄호 내용 우선 추출
- 특수문자, 공백 제거: `서울시 강남구 (테헤란로 123)` → `서울시강남구테헤란로123`
- 영문은 대문자화

### 매칭 순서

1. **정확 일치 우선**
   - 이름 + 전화번호 + 주소가 모두 일치하면 점수 100점
   
2. **유사도 매칭 (선택)**
   - 3요소의 유사도를 계산 (rapidfuzz 사용)
   - 평균 유사도가 임계값 이상이면 매칭
   
3. **중복 방지**
   - 1개의 엑셀 행은 1개의 PDF 페이지만 매칭
   - 같은 구매자가 여러 페이지에 있으면 가장 먼저 찾은 페이지만 사용

4. **미매칭 처리**
   - 매칭되지 않은 PDF 페이지는 원본 순서대로 맨 뒤에 배치

## 📊 리포트 CSV 형식

| 엑셀행번호 | 매칭페이지 | 점수 | 매칭키 | 구매자명 | 전화번호 | 주소 |
|------------|------------|------|--------|----------|----------|------|
| 2 | 5 | 100.0 | name+phone+addr | 홍길동 | 010-1234-5678 | 서울시... |
| 3 | UNMATCHED | 0.0 | no_match | 김철수 | 010-9876-5432 | 부산시... |

## 🔧 기술 스택

| 패키지 | 버전 | 용도 |
|--------|------|------|
| **PySide6** | 6.6.1 | GUI 프레임워크 |
| **pandas** | 2.1.4 | 엑셀 데이터 처리 |
| **openpyxl** | 3.1.2 | Excel(.xlsx) 읽기 |
| **xlrd** | 2.0.1 | Excel(.xls) 읽기 |
| **pdfplumber** | 0.10.3 | PDF 텍스트 추출 |
| **pypdf** | 3.17.4 | PDF 페이지 재정렬 |
| **rapidfuzz** | 3.5.2 | 유사도 계산 |
| **pyinstaller** | 6.3.0 | EXE 빌드 |

## 📁 파일 구조

```
pdf_excel_matcher/
├── main.py                 # PySide6 GUI 진입점
├── matcher.py              # 텍스트 추출/정규화/매칭 로직
├── io_utils.py             # 파일 입출력 및 버전 관리
├── requirements.txt        # 패키지 의존성
├── build.bat               # EXE 빌드 스크립트
├── README_v2.md            # 이 문서
└── .gitignore
```

## 🧪 테스트 예시

### 완전 일치

**엑셀:**
- 구매자명: `홍길동`
- 전화번호: `010-1234-5678`
- 주소: `서울시 강남구 테헤란로 123`

**PDF 페이지:**
```
구매자: 홍길동
연락처: 010-1234-5678
배송지: 서울시 강남구 테헤란로 123
```

→ **매칭 성공** (점수: 100)

### 표기 차이

**엑셀:**
- 전화번호: `010-1234-5678`

**PDF:**
- 전화번호: `01012345678`

→ **정규화 후 일치** (점수: 100)

### 주소 부분 일치

**엑셀:**
- 주소: `서울시 강남구 테헤란로 123, 101동 402호`

**PDF:**
- 주소: `(서울시 강남구 테헤란로 123)`

→ **괄호 추출 후 일치** (점수: 100)

## ⚠️ 주의사항

1. **PDF 제한**
   - 텍스트 추출 가능한 PDF만 지원
   - 이미지 스캔 PDF는 OCR 필요

2. **엑셀 컬럼**
   - `구매자명`, `전화번호`, `주소` 컬럼 필수
   - 유사한 이름도 자동 인식 (name, phone, address 등)

3. **매칭 조건**
   - 3가지 요소 모두 일치해야 매칭
   - 유사도 매칭을 켜면 오차 허용

## 🐛 문제 해결

### "컬럼을 찾을 수 없습니다" 오류
→ 엑셀 파일의 첫 번째 행에 `구매자명`, `전화번호`, `주소` 컬럼이 있는지 확인

### "이미지 스캔 PDF로 판단됩니다" 오류
→ 텍스트 추출이 가능한 PDF를 사용하거나 OCR 처리 필요

### 매칭률이 낮은 경우
→ 유사도 매칭을 켜고 임계값을 낮춰보세요 (90% → 80%)

### EXE 빌드 실패
→ 가상환경이 활성화되어 있는지 확인하고 모든 패키지가 설치되어 있는지 확인

## 📈 성능

- **처리 속도**: ~1초/페이지 (텍스트 추출 + 매칭)
- **메모리 사용**: ~150MB (기본) + PDF 크기
- **지원 규모**: 수백 페이지 PDF 처리 가능

## 📜 라이선스

MIT License

## 👨‍💻 개발 정보

- **개발 도구**: Cursor AI
- **버전**: 2.0.0
- **개발 날짜**: 2025-10-09

---

**버전**: 2.0.0  
**최종 업데이트**: 2025-10-09  
**상태**: ✅ 배포 준비 완료

